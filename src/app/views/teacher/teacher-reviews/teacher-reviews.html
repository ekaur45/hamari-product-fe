<div class="max-w-7xl mx-auto">
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h1 class="text-2xl font-bold text-gray-900 mb-6">My Reviews</h1>

        @if (reviewsData()?.stats) {
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Average Rating -->
                <div class="bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg p-6">
                    <div class="text-sm text-gray-600 mb-2">Average Rating</div>
                    <div class="flex items-center gap-3">
                        <div class="text-4xl font-bold text-gray-900">
                            {{reviewsData()?.stats?.averageRating?.toFixed(1) || 0}}
                        </div>
                        <div class="flex">
                            @for (star of getStars(Math.round(reviewsData()!.stats!.averageRating || 0)); track $index) {
                                <i class="fas fa-star text-yellow-400"></i>
                            }
                            @for (star of getStars(5 - Math.round(reviewsData()!.stats.averageRating)); track $index) {
                                <i class="far fa-star text-gray-300"></i>
                            }
                        </div>
                    </div>
                </div>

                <!-- Total Reviews -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6">
                    <div class="text-sm text-gray-600 mb-2">Total Reviews</div>
                    <div class="text-4xl font-bold text-gray-900">
                        {{reviewsData()?.stats?.totalReviews || 0}}
                    </div>
                </div>

                <!-- Rating Distribution -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6">
                    <div class="text-sm text-gray-600 mb-2">5-Star Reviews</div>
                    <div class="text-4xl font-bold text-gray-900">
                        {{findFiveStarReviews(reviewsData()!.reviews)}}
                    </div>
                </div>
            </div>

            <!-- Rating Distribution Chart -->
            @if (reviewsData()!.stats.ratingDistribution.length > 0) {
                <div class="bg-gray-50 rounded-lg p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Rating Distribution</h2>
                    <div class="space-y-3">
                        @for (dist of reviewsData()!.stats.ratingDistribution.slice().reverse(); track dist.rating) {
                            <div class="flex items-center gap-4">
                                <div class="w-16 text-sm font-medium text-gray-700">
                                    {{dist.rating}} <i class="fas fa-star text-yellow-400"></i>
                                </div>
                                <div class="flex-1 bg-gray-200 rounded-full h-4 relative">
                                    <div
                                        class="bg-primary h-4 rounded-full transition-all"
                                        [style.width.%]="reviewsData()!.stats.totalReviews > 0 ? (dist.count / reviewsData()!.stats.totalReviews) * 100 : 0">
                                    </div>
                                </div>
                                <div class="w-12 text-sm text-gray-600 text-right">
                                    {{dist.count}}
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        }
    </div>

    <!-- Reviews List -->
    <div class="bg-white rounded-lg shadow-md">
        <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">All Reviews</h2>
        </div>

        @if (isLoading()) {
            <div class="flex items-center justify-center h-64">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin text-primary text-3xl mb-3"></i>
                    <p class="text-gray-500 text-sm">Loading reviews...</p>
                </div>
            </div>
        } @else {
            @if (reviewsData()?.reviews && reviewsData()!.reviews.length > 0) {
                <div class="divide-y divide-gray-200">
                    @for (review of reviewsData()!.reviews; track review.id) {
                        <div class="p-6 hover:bg-gray-50 transition">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center">
                                            <i class="fas fa-user text-primary"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900">
                                                {{review.reviewer?.firstName}} {{review.reviewer?.lastName}}
                                            </h3>
                                            <p class="text-sm text-gray-500">{{review.createdAt | date:'medium'}}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 mb-2">
                                        @for (star of getStars(review.rating); track $index) {
                                            <i class="fas fa-star text-yellow-400"></i>
                                        }
                                        @for (star of getStars(5 - review.rating); track $index) {
                                            <i class="far fa-star text-gray-300"></i>
                                        }
                                        <span class="text-sm font-medium text-gray-700 ml-2">{{review.rating}}/5</span>
                                    </div>
                                    @if (review.comment) {
                                        <p class="text-gray-700 mt-2">{{review.comment}}</p>
                                    } @else {
                                        <p class="text-gray-400 italic text-sm mt-2">No comment provided</p>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="bg-gray-50 px-4 py-3 border-t border-gray-200">
                    <p-paginator
                        [totalRecords]="pagination().total"
                        [rows]="rows()"
                        [first]="first()"
                        [showCurrentPageReport]="true"
                        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} reviews"
                        [rowsPerPageOptions]="[5,10,20,50]"
                        (onPageChange)="onPageChange($event)">
                    </p-paginator>
                </div>
            } @else {
                <div class="flex items-center justify-center h-64">
                    <div class="text-center">
                        <i class="fas fa-star text-gray-400 text-4xl mb-3"></i>
                        <p class="text-gray-500">No reviews yet</p>
                        <p class="text-sm text-gray-400 mt-2">Reviews from students will appear here</p>
                    </div>
                </div>
            }
        }
    </div>
</div>

<p-toast></p-toast>

