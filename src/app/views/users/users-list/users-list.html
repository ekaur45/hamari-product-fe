
  <!-- Header Section -->
  <div class="flex items-center justify-between mb-6 bg-white rounded-lg border border-gray-200 p-4 mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Users</h1>
      <p class="text-sm text-gray-600 mt-1">Manage system users and their permissions</p>
    </div>
    <a routerLink="/users/new" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
      <i class="pi pi-plus mr-2 text-sm"></i>
      Add User
    </a>
  </div>

  <!-- Search and Filters -->
  <div class="bg-white rounded-lg border border-gray-200 p-4 mb-6">
    <div class="flex items-center flex-wrap gap-4">
      <div class="flex-1 max-w-md">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="pi pi-search text-gray-400 text-sm"></i>
          </div>
          <input
            type="text"
            placeholder="Search users by name, email, or username..."
            [value]="search"
            (input)="onSearchInput($event)"
            class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="min-w-[180px]">
          <p-select 
            [options]="roleOptions"
            [(ngModel)]="filterRole"
            (onChange)="onRoleFilterChange(filterRole)"
            placeholder="All Roles"
            [showClear]="false"
            styleClass="w-full"
          ></p-select>
        </div>
        <div class="min-w-[160px]">
          <p-select 
            [options]="statusOptions"
            [(ngModel)]="filterActive"
            (onChange)="onStatusFilterChange(filterActive)"
            placeholder="All Status"
            [showClear]="false"
            styleClass="w-full"
          ></p-select>
        </div>
      </div>
    </div>
  </div>

  <!-- Users Table using PrimeNG -->
  <div class="bg-white rounded-lg border border-gray-200">
    <p-table
      [value]="users"
      [lazy]="true"
      (onLazyLoad)="onTableLazyLoad($event)"
      [paginator]="true"
      [rows]="limit"
      [totalRecords]="total"
      [first]="(page - 1) * limit"
      [rowsPerPageOptions]="[10,20,50,100]"
      [loading]="isLoading()"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>User</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th>Created</th>
          <th class="flex items-center justify-center" >Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-u>
        <tr>
          <td>
            <div class="flex items-center">
              <div class="flex-shrink-0 h-8 w-8">
                <div class="h-8 w-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                  <span class="text-xs font-medium text-white">{{ u.firstName.charAt(0) }}{{ u.lastName.charAt(0) }}</span>
                </div>
              </div>
              <div class="ml-3">
                <div class="text-sm font-medium text-gray-900">{{ u.firstName }} {{ u.lastName }}</div>
              </div>
            </div>
          </td>
          <td>
            <div class="text-sm text-gray-900">{{ u.email }}</div>
          </td>
          <td>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" 
                  [class.bg-red-100]="u.role === 'Admin'" 
                  [class.text-red-800]="u.role === 'Admin'"
                  [class.bg-purple-100]="u.role === 'Academy Owner'" 
                  [class.text-purple-800]="u.role === 'Academy Owner'"
                  [class.bg-blue-100]="u.role === 'Teacher'" 
                  [class.text-blue-800]="u.role === 'Teacher'"
                  [class.bg-green-100]="u.role === 'Student'" 
                  [class.text-green-800]="u.role === 'Student'"
                  [class.bg-yellow-100]="u.role === 'Parent'" 
                  [class.text-yellow-800]="u.role === 'Parent'">
              {{ u.role }}
            </span>
          </td>
          <td>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" 
                  [class.bg-green-100]="u.isActive" 
                  [class.text-green-800]="u.isActive"
                  [class.bg-gray-100]="!u.isActive" 
                  [class.text-gray-800]="!u.isActive">
              <span class="w-1.5 h-1.5 rounded-full mr-1.5" 
                    [class.bg-green-400]="u.isActive" 
                    [class.bg-gray-400]="!u.isActive"></span>
              {{ u.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>
            <div class="text-sm text-gray-500">{{ u.createdAt | date:'MMM d, y' }}</div>
          </td>
          <td class="flex items-center justify-center">
            <p-button (onClick)="openView(u)" text="true" severity="info" class="mr-2" title="View" icon="pi pi-eye"></p-button>
            <p-button [routerLink]="['/users', u.id, 'edit']" text="true" severity="success" class="mr-2" title="Edit" icon="pi pi-pencil"></p-button>
            <p-button (onClick)="onDelete(u)" text="true" severity="danger" class="mr-2" title="Delete" icon="pi pi-trash"></p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">
            <div class="text-center py-10 text-sm text-gray-500">No users found.</div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- View Details Dialog -->
  <p-dialog [(visible)]="viewDialogVisible" [modal]="true" [style]="{width: '560px'}" [draggable]="false" [resizable]="false" [dismissableMask]="true">
    <ng-template pTemplate="header">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-full bg-blue-600 text-white flex items-center justify-center">
          <i class="pi pi-user text-sm"></i>
        </div>
        <span class="font-semibold">User Details</span>
      </div>
    </ng-template>

    <div *ngIf="selectedUser as u" class="space-y-5">
      <!-- Hero -->
      <div class="flex items-center gap-4">
        <div class="h-14 w-14 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white text-lg font-semibold">
          {{ u.firstName?.charAt(0) }}{{ u.lastName?.charAt(0) }}
        </div>
        <div class="flex-1">
          <div class="text-lg font-semibold text-gray-900">{{ u.firstName }} {{ u.lastName }}</div>
          <div class="text-sm text-gray-500">@{{ u.username }}</div>
          <div class="mt-2 flex flex-wrap items-center gap-2">
            <!-- Role badge -->
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                  [class.bg-red-100]="u.role === 'Admin'" [class.text-red-800]="u.role === 'Admin'"
                  [class.bg-purple-100]="u.role === 'Academy Owner'" [class.text-purple-800]="u.role === 'Academy Owner'"
                  [class.bg-blue-100]="u.role === 'Teacher'" [class.text-blue-800]="u.role === 'Teacher'"
                  [class.bg-green-100]="u.role === 'Student'" [class.text-green-800]="u.role === 'Student'"
                  [class.bg-yellow-100]="u.role === 'Parent'" [class.text-yellow-800]="u.role === 'Parent'">
              <i class="pi pi-id-card mr-1"></i>
              {{ u.role }}
            </span>
            <!-- Status badge -->
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                  [class.bg-green-100]="u.isActive" [class.text-green-800]="u.isActive"
                  [class.bg-gray-100]="!u.isActive" [class.text-gray-800]="!u.isActive">
              <span class="w-1.5 h-1.5 rounded-full mr-1.5" [class.bg-green-400]="u.isActive" [class.bg-gray-400]="!u.isActive"></span>
              {{ u.isActive ? 'Active' : 'Inactive' }}
            </span>
          </div>
        </div>
      </div>

      <div class="border-t border-gray-100"></div>

      <!-- Details grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
        <div class="flex items-start gap-2">
          <i class="pi pi-envelope text-gray-400 mt-0.5"></i>
          <div>
            <div class="text-gray-500">Email</div>
            <div class="text-gray-900 break-all">{{ u.email }}</div>
          </div>
        </div>
        <div class="flex items-start gap-2">
          <i class="pi pi-calendar text-gray-400 mt-0.5"></i>
          <div>
            <div class="text-gray-500">Created</div>
            <div class="text-gray-900">{{ u.createdAt | date:'medium' }}</div>
          </div>
        </div>
        <div class="flex items-start gap-2">
          <i class="pi pi-phone text-gray-400 mt-0.5"></i>
          <div>
            <div class="text-gray-500">Phone</div>
            <div class="text-gray-900">{{ u.userDetails?.phone || '-' }}</div>
          </div>
        </div>
        <div class="flex items-start gap-2">
          <i class="pi pi-map-marker text-gray-400 mt-0.5"></i>
          <div>
            <div class="text-gray-500">Address</div>
            <div class="text-gray-900">{{ u.userDetails?.address || '-' }}</div>
          </div>
        </div>
      </div>

      <div class="border-t border-gray-100"></div>

      <!-- Quick actions -->
      <div class="flex flex-wrap items-center gap-2">
        <p-button label="Edit" icon="pi pi-pencil" [routerLink]="['/users', u.id, 'edit']" severity="success"></p-button>
        <p-button label="Copy Email" icon="pi pi-copy" (onClick)="copyToClipboard(u.email)" severity="secondary"></p-button>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button label="Close" icon="pi pi-times" (onClick)="closeView()"></p-button>
    </ng-template>
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
