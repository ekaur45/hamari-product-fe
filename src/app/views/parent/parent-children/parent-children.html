<div class="p-6">
    <div class="flex items-center justify-between mb-8">
        <div>
            <h2 class="text-3xl font-bold text-gray-900">My Children</h2>
            <p class="text-gray-600 mt-1">Manage and link your children to monitor their progress.</p>
        </div>
        <button (click)="showAddModal.set(true)"
            class="bg-primary text-white px-6 py-2.5 rounded-lg font-semibold hover:bg-opacity-90 transition flex items-center shadow-lg">
            <i class="fas fa-plus mr-2"></i>
            Link New Child
        </button>
    </div>

    <!-- Alert Message -->
    @if (message()) {
    <div [class]="isError() ? 'bg-red-50 text-red-700 border-red-200' : 'bg-green-50 text-green-700 border-green-200'"
        class="mb-6 p-4 rounded-lg border flex items-center justify-between animate-fade-in">
        <div class="flex items-center">
            <i [class]="isError() ? 'fas fa-exclamation-circle' : 'fas fa-check-circle'" class="mr-3 text-lg"></i>
            <span>{{ message() }}</span>
        </div>
        <button (click)="message.set('')" class="text-lg">&times;</button>
    </div>
    }

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (child of children(); track child.id) {
        <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-xl transition-all group overflow-hidden relative">
            <div class="absolute top-0 right-0 p-4">
                <button class="text-gray-400 hover:text-red-500 transition">
                    <i class="fas fa-unlink"></i>
                </button>
            </div>

            <div class="flex flex-col items-center text-center">
                <div class="relative mb-4">
                    @if (child.profileImage) {
                    <img [src]="child.profileImage"
                        class="w-24 h-24 rounded-full object-cover ring-4 ring-primary ring-offset-2">
                    } @else {
                    <div
                        class="w-24 h-24 bg-gradient-to-br from-primary to-blue-600 rounded-full flex items-center justify-center ring-4 ring-primary ring-offset-2">
                        <i class="fas fa-child text-white text-3xl"></i>
                    </div>
                    }
                </div>

                <h3 class="text-xl font-bold text-gray-900">{{ child.firstName }} {{ child.lastName }}</h3>
                <p class="text-sm text-gray-500 mb-4">{{ child.email }}</p>

                <div class="w-full grid grid-cols-2 gap-4 pt-4 border-t border-gray-50">
                    <div class="text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Status</p>
                        <span
                            class="inline-block mt-1 px-2 py-0.5 bg-green-100 text-green-700 text-[10px] rounded-full font-bold">ACTIVE</span>
                    </div>
                    <div class="text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Courses</p>
                        <p class="text-sm font-bold text-gray-900">0</p>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex gap-2">
                <button
                    class="flex-1 bg-blue-50 text-blue-600 py-2 rounded-lg text-sm font-bold hover:bg-blue-100 transition">View
                    Progress</button>
                <button
                    class="flex-1 bg-orange-50 text-orange-600 py-2 rounded-lg text-sm font-bold hover:bg-orange-100 transition">Schedule</button>
            </div>
        </div>
        } @empty {
        <div class="col-span-full py-20 text-center bg-white rounded-2xl border-2 border-dashed border-gray-100">
            <div class="w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-user-plus text-gray-300 text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900">No Children Linked</h3>
            <p class="text-gray-500 mt-2 max-w-xs mx-auto">Link your child's account using their email address to start
                monitoring their activities.</p>
            <button (click)="showAddModal.set(true)" class="mt-6 text-primary font-bold hover:underline">Link your first
                child now</button>
        </div>
        }
    </div>

    <!-- Link Child Modal -->
    @if (showAddModal()) {
    <div
        class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm animate-fade-in p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-slide-up">
            <div class="p-6 border-b border-gray-50 flex items-center justify-between bg-primary group">
                <h3 class="text-xl font-bold text-white">Link Child Account</h3>
                <button (click)="showAddModal.set(false)" class="text-white hover:rotate-90 transition-transform"><i
                        class="fas fa-times"></i></button>
            </div>

            <div class="p-8">
                <div class="mb-6 text-center">
                    <div
                        class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 text-primary">
                        <i class="fas fa-envelope-open-text text-2xl"></i>
                    </div>
                    <p class="text-gray-600">Enter your child's registered email address to send a link request.</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Child's Email Address</label>
                        <input [(ngModel)]="childEmail" type="email" placeholder="e.g. child@example.com"
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary focus:ring-opacity-20 transition outline-none">
                    </div>

                    <button [disabled]="isLoading() || !childEmail()" (click)="addChild()"
                        class="w-full bg-primary text-white py-4 rounded-xl font-bold shadow-lg shadow-primary/20 hover:shadow-primary/40 disabled:bg-gray-300 disabled:shadow-none transition-all flex items-center justify-center">
                        @if (isLoading()) {
                        <i class="fas fa-circle-notch fa-spin mr-2"></i> Processing...
                        } @else {
                        <i class="fas fa-link mr-2"></i> Link Account
                        }
                    </button>
                </div>
            </div>

            <div class="p-4 bg-gray-50 text-center">
                <p class="text-xs text-gray-500">The child must have a registered student account on the platform.</p>
            </div>
        </div>
    </div>
    }
</div>