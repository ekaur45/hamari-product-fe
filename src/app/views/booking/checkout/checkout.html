<!-- Checkout Page -->
@if(isLoading()) {
<div class="flex items-center justify-center min-h-screen">
    <div class="text-center">
        <i class="fas fa-spinner fa-spin text-4xl text-primary mb-4"></i>
        <p class="text-gray-600">Loading checkout details...</p>
    </div>
</div>
} @else {
<div class="max-w-4xl mx-auto px-4 py-6">
    <!-- Back Button -->
    <button [routerLink]="['/booking']" 
        class="mb-6 px-4 py-2 text-gray-600 hover:text-gray-900 transition flex items-center gap-2">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Booking</span>
    </button>

    <!-- Page Title -->
    <h1 class="text-3xl font-bold text-gray-900 mb-8">Complete Your Booking</h1>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        <!-- Left Column: Booking Details (2/3 width) -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Subject Details Card -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-book text-primary text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Subject</h2>
                        <h3 class="text-2xl font-bold text-gray-900">{{subject()?.name}}</h3>
                    </div>
                </div>
                @if(subject()?.description) {
                <p class="text-gray-600 leading-relaxed">{{subject()?.description}}</p>
                }
            </div>

            <!-- Teacher Details Card -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white font-semibold text-lg">
                        {{teacher()?.user?.firstName?.charAt(0) || ''}}{{teacher()?.user?.lastName?.charAt(0) || ''}}
                    </div>
                    <div class="flex-1">
                        <h2 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Teacher</h2>
                        <h3 class="text-xl font-bold text-gray-900">
                            {{teacher()?.user?.firstName}} {{teacher()?.user?.lastName}}
                        </h3>
                    </div>
                </div>
                @if(teacher()?.tagline) {
                <p class="text-gray-600 italic mb-3">"{{teacher()?.tagline}}"</p>
                }
                @if(teacher()?.yearsOfExperience) {
                <div class="flex items-center gap-2 text-sm text-gray-600">
                    <i class="fas fa-award text-primary"></i>
                    <span>{{teacher()?.yearsOfExperience}} years of experience</span>
                </div>
                }
            </div>

            <!-- Slot Details Card -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-clock text-primary text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Time Slot</h2>
                    </div>
                </div>
                <div class="space-y-3">
                    @if(selectedDate()) {
                    <div class="flex items-center gap-3">
                        <i class="fas fa-calendar text-gray-400"></i>
                        <div>
                            <p class="text-sm text-gray-500">Date</p>
                            <p class="text-lg font-semibold text-gray-900">
                                {{selectedDate() | date:'fullDate'}}
                            </p>
                        </div>
                    </div>
                    }
                    @if(slot()) {
                    <div class="flex items-center gap-3">
                        <i class="fas fa-clock text-gray-400"></i>
                        <div>
                            <p class="text-sm text-gray-500">Time</p>
                            <p class="text-lg font-semibold text-gray-900">
                                {{slot()?.startTime}} - {{slot()?.endTime}}
                            </p>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>

        <!-- Right Column: Checkout Summary (1/3 width) -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 sticky top-6">
                <h2 class="text-xl font-bold text-gray-900 mb-6">Booking Summary</h2>
                
                <div class="space-y-4 mb-6">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Subject</span>
                        <span class="font-medium text-gray-900">{{subject()?.name}}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Teacher</span>
                        <span class="font-medium text-gray-900">
                            {{teacher()?.user?.firstName}} {{teacher()?.user?.lastName}}
                        </span>
                    </div>
                    @if(selectedDate()) {
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Date</span>
                        <span class="font-medium text-gray-900">
                            {{selectedDate() | date:'shortDate'}}
                        </span>
                    </div>
                    }
                    @if(slot()) {
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Time</span>
                        <span class="font-medium text-gray-900">
                            {{slot()?.startTime}} - {{slot()?.endTime}}
                        </span>
                    </div>
                    }
                    @if(teacher()?.hourlyRate) {
                    <div class="border-t border-gray-200 pt-4 mt-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Rate</span>
                            <span class="text-lg font-bold text-gray-900">
                                ${{teacher()?.hourlyRate}}/hour
                            </span>
                        </div>
                    </div>
                    }
                </div>

                <!-- Checkout Button -->
                <button 
                    (click)="proceedToCheckout()"
                    class="w-full bg-primary text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary/90 transition shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-lock"></i>
                    <span>Confirm Booking</span>
                </button>

                <p class="text-xs text-gray-500 text-center mt-4">
                    <i class="fas fa-shield-alt mr-1"></i>
                    Secure checkout
                </p>
            </div>
        </div>
    </div>
</div>
}

<!-- Payment Method Selection Dialog -->
<p-dialog 
    [(visible)]="showPaymentDialog" 
    [modal]="true" 
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="w-full max-w-md"
    (onHide)="closePaymentDialog()">
    <ng-template pTemplate="header">
        <div class="flex items-center justify-between w-full">
            <h2 class="text-2xl font-bold text-gray-900">Select Payment Method</h2>
        </div>
    </ng-template>
    
    <div class="space-y-4">
        <!-- Card Payment Option -->
        <div 
            class="border-2 rounded-lg p-4 cursor-pointer transition-all hover:shadow-md"
            [class.border-primary]="selectedPaymentMethod() === 'card'"
            [class.border-gray-200]="selectedPaymentMethod() !== 'card'"
            [class.bg-primary/5]="selectedPaymentMethod() === 'card'"
            (click)="selectPaymentMethod('card')">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                    <i class="fas fa-credit-card text-primary text-xl"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">Card</h3>
                    <p class="text-sm text-gray-600">Pay with credit or debit card</p>
                </div>
                @if(selectedPaymentMethod() === 'card') {
                <i class="fas fa-check-circle text-primary text-xl"></i>
                }
            </div>
        </div>

        <!-- Wallet Payment Option -->
        <div 
            class="border-2 rounded-lg p-4 cursor-pointer transition-all hover:shadow-md"
            [class.border-primary]="selectedPaymentMethod() === 'wallet'"
            [class.border-gray-200]="selectedPaymentMethod() !== 'wallet'"
            [class.bg-primary/5]="selectedPaymentMethod() === 'wallet'"
            (click)="selectPaymentMethod('wallet')">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                    <i class="fas fa-wallet text-primary text-xl"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">Wallet</h3>
                    <p class="text-sm text-gray-600">Easypaisa, JazzCash, and other mobile wallets</p>
                </div>
                @if(selectedPaymentMethod() === 'wallet') {
                <i class="fas fa-check-circle text-primary text-xl"></i>
                }
            </div>
        </div>

        <!-- Bank Transfer Option -->
        <div 
            class="border-2 rounded-lg p-4 cursor-pointer transition-all hover:shadow-md"
            [class.border-primary]="selectedPaymentMethod() === 'bank'"
            [class.border-gray-200]="selectedPaymentMethod() !== 'bank'"
            [class.bg-primary/5]="selectedPaymentMethod() === 'bank'"
            (click)="selectPaymentMethod('bank')">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
                    <i class="fas fa-university text-primary text-xl"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">Bank Transfer</h3>
                    <p class="text-sm text-gray-600">Direct bank transfer</p>
                </div>
                @if(selectedPaymentMethod() === 'bank') {
                <i class="fas fa-check-circle text-primary text-xl"></i>
                }
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-end gap-3">
            <button 
                type="button"
                (click)="closePaymentDialog()"
                class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition">
                Cancel
            </button>
            <button 
                type="button"
                (click)="confirmPayment()"
                [disabled]="!selectedPaymentMethod()"
                class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                <i class="fas fa-check"></i>
                <span>Proceed to Payment</span>
            </button>
        </div>
    </ng-template>
</p-dialog>
