<div class="bg-gray-900 grid">
    <header
        class="bg-gray-800 text-white px-2 sm:px-4 py-2 sm:py-3 flex items-center justify-between border-b border-gray-700">
        <div class="flex items-center space-x-2 sm:space-x-4 flex-1 min-w-0">
            <a (click)="leaveSession()"
                class="flex items-center text-primary hover:text-blue-400 transition flex-shrink-0 cursor-pointer">
                <i class="fas fa-arrow-left mr-1 sm:mr-2"></i>
                <span class="hidden sm:inline">Back to Dashboard</span>
            </a>
            <div class="h-6 w-px bg-gray-600 hidden sm:block"></div>
            <div class="min-w-0 flex-1">
                <h2 class="text-sm sm:text-lg font-semibold truncate">{{booking()?.teacherSubject?.subject?.name}}</h2>
                <p class="text-xs sm:text-sm text-gray-400 truncate hidden sm:block">Session ID: {{booking()?.id}}</p>
            </div>
        </div>
        <div class="flex items-center space-x-2 sm:space-x-4 flex-shrink-0">
            <div class="flex items-center space-x-1 sm:space-x-2 bg-green-600 px-2 sm:px-3 py-1 rounded-lg">
                <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                <span class="text-xs sm:text-sm font-medium">{{ 1==1 ? 'LIVE' : 'NOT LIVE'
                    }}</span>
            </div>
            <div class="text-xs sm:text-sm text-gray-300">
                <i class="far fa-clock mr-1"></i>
                <span>{{ sessionTime() }}</span>
            </div>
        </div>
    </header>

    <div class="flex flex-col md:flex-row h-[calc(100vh-146px)] overflow-hidden">
        <!-- Main Video Area -->
        <div class="flex-1 flex flex-col p-2 sm:p-4 space-y-2 sm:space-y-4 overflow-y-auto">
            <!-- Teacher/Shared Screen Area (Main) -->
            <div class="flex-1 video-container">
                <!-- Video View -->
                <div #videoView class="w-full h-full flex items-center justify-center bg-gray-950">
                    <!-- Video or Screen Share -->
                    <video #videoElement [class.hidden]="!localStream" [srcObject]="localStream"
                        class="w-full h-full flex items-center justify-center" autoplay playsinline muted
                        style="transform: scaleX(-1);"></video>
                    <!-- Video Overlay Info -->
                    <div class="video-overlay">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <profile-photo [user]="currentUserDetails()"></profile-photo>
                                <div>
                                    <p class="text-white font-medium text-sm">{{ currentUserDetails()?.firstName }} {{
                                        currentUserDetails()?.lastName }}</p>
                                    <p class="text-gray-300 text-xs">{{ currentUserDetails()?.role === UserRole.TEACHER
                                        ? 'Teacher' : 'Student' }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Students Video Grid -->
            @if(remoteStreams.length>0){
            <div class="bg-gray-800 rounded-lg p-3">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-white font-medium text-sm">
                        <i class="fas fa-users mr-2"></i>
                        Participants (<span id="participantCount">{{remoteStreams.length}}</span>)
                    </h3>
                </div>

                <div [class]="'video-grid grid-' + gridSize()">
                    @for(s of remoteStreams;track s.stream.id){
                    <div class="video-container aspect-video">
                        <div class="w-full h-full flex items-center justify-center bg-gray-950">
                            <video [appStream]="s.stream" autoplay playsinline class="remote-video">
                            </video>
                        </div>
                        <div class="video-overlay">
                            <div class="text-center text-gray-500">
                                <i class="fas fa-user text-2xl mb-1 opacity-50"></i>
                                <p class="text-xs">Student</p>
                            </div>
                            <div class="flex items-center justify-between">
                                <p class="text-white text-xs font-medium">{{ otherParticipant()?.user?.firstName }} {{
                                    otherParticipant()?.user?.lastName }}</p>
                                <div class="flex items-center space-x-1">
                                    <span class="w-2 h-2 rounded-full" [ngClass]="{
                                        'bg-green-500': getStreamController(s.stream).video,
                                        'bg-red-500': !getStreamController(s.stream).video
                                    }"></span>
                                    <i class="fas fa-microphone text-xs" [ngClass]="{
                                        'text-green-500': getStreamController(s.stream).audio,
                                        'text-red-500': !getStreamController(s.stream).audio
                                    }"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    }



                    <!-- Empty slot for grid alignment -->
                    <div class="video-container aspect-video border-2 border-dashed border-gray-600 hidden">
                        <div class="w-full h-full flex items-center justify-center">
                            <i class="fas fa-user-plus text-gray-500 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            }
        </div>
    </div>
    <div class="sticky bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 px-2 sm:px-4 md:px-6 py-2 sm:py-4 pb-safe z-40"
        style="padding-bottom: max(0.5rem, env(safe-area-inset-bottom));">
        <div class="flex items-center justify-between max-w-7xl mx-auto flex-wrap gap-2">
            <!-- Left Controls -->
            <div class="flex items-center space-x-1 sm:space-x-3 flex-1 justify-center sm:justify-start">
                <button (click)="onToggleMic()" [class.bg-green-600]="getStreamController(localStream).audio"
                    [class.hover:bg-green-700]="getStreamController(localStream).audio"
                    [class.bg-red-600]="!getStreamController(localStream).audio"
                    [class.hover:bg-red-700]="!getStreamController(localStream).audio"
                    class="w-10 h-10 sm:w-12 sm:h-12 text-white rounded-full flex items-center justify-center transition flex-shrink-0">
                    <i [class.fa-microphone]="getStreamController(localStream).audio"
                        [class.fa-microphone-slash]="!getStreamController(localStream).audio"
                        class="fas text-sm sm:text-base"></i>
                </button>
                <button (click)="onToggleVideo()" [class.bg-green-600]="getStreamController(localStream).video"
                    [class.hover:bg-green-700]="getStreamController(localStream).video"
                    [class.bg-red-600]="!getStreamController(localStream).video"
                    [class.hover:bg-red-700]="!getStreamController(localStream).video"
                    class="w-10 h-10 sm:w-12 sm:h-12 text-white rounded-full flex items-center justify-center transition flex-shrink-0">
                    <i [class.fa-video]="getStreamController(localStream).video"
                        [class.fa-video-slash]="!getStreamController(localStream).video"
                        class="fas text-sm sm:text-base"></i>
                </button>
                <button id="toggleScreenShare"
                    class="w-10 h-10 sm:w-12 sm:h-12 bg-gray-700 hover:bg-gray-600 text-white rounded-full flex items-center justify-center transition flex-shrink-0 hidden sm:flex">
                    <i class="fas fa-desktop text-sm sm:text-base"></i>
                </button>
                <!-- <button #toggleWhiteboard (click)="onToggleWhiteboard()" [class.bg-primary]="whiteboardOpen()"
                    [class.hover:bg-blue-600]="whiteboardOpen()" [class.bg-gray-700]="!whiteboardOpen()"
                    [class.hover:bg-gray-600]="!whiteboardOpen()"
                    class="w-10 h-10 sm:w-12 sm:h-12 text-white rounded-full flex items-center justify-center transition flex-shrink-0">
                    <i class="fas fa-pencil-alt text-sm sm:text-base"></i>
                </button>
                <span #whiteboardActive [class.hidden]="!whiteboardOpen()"
                    class="px-2 py-1 bg-green-600 text-white rounded text-xs">
                    <i class="fas fa-check mr-1"></i><span class="hidden sm:inline">Whiteboard Active</span>
                </span> -->
            </div>

            <!-- Center Controls -->
            <div class="flex items-center space-x-1 sm:space-x-3 flex-1 justify-center">
                <button
                    class="px-2 sm:px-4 py-1.5 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition text-xs sm:text-sm hidden sm:flex items-center">
                    <i class="fas fa-cog sm:mr-2"></i><span class="hidden md:inline">Settings</span>
                </button>
                <button
                    class="px-2 sm:px-4 py-1.5 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition text-xs sm:text-sm flex items-center md:hidden">
                    <i class="fas fa-comments"></i>
                </button>
                <button
                    class="px-2 sm:px-4 py-1.5 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition text-xs sm:text-sm hidden md:flex items-center">
                    <i class="fas fa-comments sm:mr-2"></i><span class="hidden md:inline">Chat</span>
                </button>
            </div>

            <!-- Right Controls -->
            <div class="flex items-center space-x-1 sm:space-x-3 flex-1 justify-center sm:justify-end">
                <button id="toggleParticipants"
                    class="px-2 sm:px-4 py-1.5 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition text-xs sm:text-sm hidden md:flex items-center">
                    <i class="fas fa-users sm:mr-2"></i><span class="hidden md:inline">People</span>
                </button>
                <button #leaveSessionBtn (click)="leaveSession()"
                    class="px-3 sm:px-4 py-1.5 sm:py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition text-xs sm:text-sm flex items-center flex-shrink-0">
                    <i class="fas fa-phone-slash sm:mr-2"></i><span class="hidden sm:inline">Leave</span>
                </button>
            </div>
        </div>
    </div>
</div>