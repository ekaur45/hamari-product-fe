<p-toast />
<form class="form-section" [formGroup]="professionalForm">
    <div class="bg-white rounded-xl shadow-lg p-8 space-y-10">
        <!-- Introduction Section -->
        <div class="space-y-6">
            <div class="pb-2 border-b border-gray-100">
                <h4 class="text-2xl font-bold text-gray-900 mb-2 flex items-center gap-3">
                    <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-user-circle text-primary text-lg"></i>
                    </div>
                    <span>Introduction</span>
                </h4>
                <p class="text-sm text-gray-600 mt-2 ml-13">Tell students about yourself and your teaching approach</p>
            </div>

            <!-- About You Textarea -->
            <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-800 mb-2">
                    <i class="fas fa-info-circle mr-2 text-primary"></i>
                    About You
                    <span class="text-red-500 ml-1">*</span>
                </label>
                <div class="relative">
                    <textarea rows="5"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition resize-none bg-gray-50/50"
                        placeholder="Write a brief introduction about yourself, your teaching philosophy, and what makes you unique..."
                        name="introduction"
                        formControlName="introduction"></textarea>
                </div>
                @if(professionalForm.get('introduction')?.invalid && professionalForm.get('introduction')?.touched) {
                <p class="mt-1 text-xs text-red-600 flex items-center gap-1">
                    <i class="fas fa-exclamation-circle"></i>
                    Introduction is required
                </p>
                }
            </div>

            <!-- Video Upload Section -->
            <div class="space-y-6 bg-gray-50/50 rounded-lg p-6 border border-gray-200">
                <div class="mb-4">
                    <h5 class="text-lg font-semibold text-gray-900 mb-1 flex items-center gap-2">
                        <i class="fas fa-video text-primary"></i>
                        <span>Introduction Video</span>
                    </h5>
                    <p class="text-xs text-gray-600">Upload a video or provide a YouTube link to introduce yourself</p>
                </div>

                <!-- Video Thumbnail Upload -->
                <div class="flex items-center gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            <i class="fas fa-image mr-2 text-primary"></i>
                            Video Thumbnail
                            <span class="text-red-500">*</span>
                        </label>
                        
                        @if(professionalForm.get('introductionVideoThumbnailUrl')?.value) {
                        <!-- Thumbnail Preview -->
                        <div class="relative border border-gray-300 rounded-lg overflow-hidden bg-white w-64 h-48">
                            <img [src]="assetsUrl + professionalForm.get('introductionVideoThumbnailUrl')?.value!" alt="Thumbnail preview" class="w-full h-48 object-cover">
                            <button type="button" 
                                (click)="removeThumbnail()"
                                class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 transition-colors shadow-lg w-8 h-8 flex items-center justify-center">
                                <i class="fas fa-times text-sm"></i>
                            </button>
                            <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs p-2">
                                <i class="fas fa-image mr-1"></i>
                                Thumbnail selected
                            </div>
                        </div>
                        } @else {
                        <!-- Upload Area -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary hover:bg-primary/5 transition-all duration-200 cursor-pointer group w-64 h-48">
                            <input type="file" id="thumbnailUpload" accept="image/*" class="hidden" (change)="onThumbnailSelected($event)" />
                            @if(isThumbnailUploading()) {
                            <div class="flex items-center justify-center h-full">
                                <i class="fas fa-spinner fa-spin text-primary text-2xl"></i>
                            </div>
                            } @else {
                            <label for="thumbnailUpload" class="cursor-pointer block">
                                <div class="flex flex-col items-center gap-3">
                                    <div class="w-14 h-14 bg-primary/10 group-hover:bg-primary/20 rounded-full flex items-center justify-center transition-colors">
                                        <i class="fas fa-cloud-upload-alt text-primary text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">
                                            <span class="text-primary group-hover:underline">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-gray-500 mt-1">JPEG, PNG, GIF (Max 10MB)</p>
                                    </div>
                                    </div>
                                </label>
                            }
                        </div>
                        }
                    </div>
    
                    <!-- Video File Upload -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            <i class="fas fa-file-video mr-2 text-primary"></i>
                            Video File
                        </label>
                        
                        @if(professionalForm.get('introductionVideo')?.value) {
                        <!-- Video Preview -->
                        <div class="relative border border-gray-300 rounded-lg overflow-hidden bg-black w-64 h-48">
                            <video [src]="assetsUrl + professionalForm.get('introductionVideo')?.value!" controls class="w-full h-64 object-contain"></video>
                            <button type="button" 
                                (click)="removeVideo()"
                                class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 transition-colors shadow-lg z-10 w-8 h-8 flex items-center justify-center">
                                <i class="fas fa-times text-sm"></i>
                            </button>
                            <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs p-2">
                                <i class="fas fa-video mr-1"></i>
                                Video selected
                            </div>
                        </div>
                        } @else {
                        <!-- Upload Area -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary hover:bg-primary/5 transition-all duration-200 cursor-pointer group w-64 h-48">
                            @if(isVideoUploading()) {
                            <div class="flex items-center justify-center h-full">
                                <i class="fas fa-spinner fa-spin text-primary text-2xl"></i>
                            </div>
                            } @else {
                            <input type="file" id="videoFileUpload" accept="video/*" class="hidden" (change)="onVideoSelected($event)" />
                            <label for="videoFileUpload" class="cursor-pointer block">
                                <div class="flex flex-col items-center gap-3">
                                    <div class="w-14 h-14 bg-primary/10 group-hover:bg-primary/20 rounded-full flex items-center justify-center transition-colors">
                                        <i class="fas fa-cloud-upload-alt text-primary text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">
                                            <span class="text-primary group-hover:underline">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-gray-500 mt-1">MP4, MOV, AVI (Max 100MB)</p>
                                    </div>
                                    </div>
                                </label>
                            }
                        </div>
                        }
                    </div>
                </div>

                <!-- Divider -->
                <div class="flex items-center gap-4 my-4">
                    <div class="flex-1 border-t border-gray-300"></div>
                    <span class="text-xs text-gray-500 font-semibold uppercase tracking-wider bg-gray-50 px-3 py-1 rounded-full">OR</span>
                    <div class="flex-1 border-t border-gray-300"></div>
                </div>

                <!-- YouTube Link Input -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">
                        <i class="fab fa-youtube mr-2 text-red-500"></i>
                        YouTube Video Link
                    </label>
                    
                    @if(youtubeVideoId()) {
                    <!-- YouTube Preview -->
                    <div class="space-y-3">
                        <div class="relative border border-gray-300 rounded-lg overflow-hidden bg-white">
                            <div class="aspect-video bg-black">
                                <iframe 
                                    [src]="getYouTubeEmbedUrl()" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen
                                    class="w-full h-full">
                                </iframe>
                            </div>
                            <button type="button" 
                                (click)="removeYouTubeLink()"
                                class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 transition-colors shadow-lg z-10">
                                <i class="fas fa-times text-sm"></i>
                            </button>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-gray-600 bg-gray-50 p-2 rounded">
                            <i class="fab fa-youtube text-red-500"></i>
                            <span>YouTube video loaded</span>
                        </div>
                    </div>
                    } @else {
                    <!-- Input Field -->
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fab fa-youtube text-gray-400 text-lg"></i>
                        </div>
                        <input type="url" 
                            name="youtubeLink" 
                            formControlName="youtubeLink"
                            placeholder="https://www.youtube.com/watch?v=..."
                            class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition bg-white"
                            [ngClass]="{'disabled:opacity-50 cursor-not-allowed': professionalForm.get('introductionVideo')?.value }"
                            [readonly]="professionalForm.get('introductionVideo')?.value"
                            >
                    </div>
                    <p class="mt-1 text-xs text-gray-500 flex items-center gap-1">
                        <i class="fas fa-info-circle"></i>
                        Paste your YouTube video URL here
                    </p>
                    }
                </div>

                <!-- Video Title and Description -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            <i class="fas fa-heading mr-2 text-primary"></i>
                            Video Title
                        </label>
                        <input type="text" 
                            name="introductionVideoTitle" 
                            formControlName="introductionVideoTitle" 
                            placeholder="Enter video title" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition bg-white">                    
                    </div>
                    <div class="space-y-2 md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700">
                            <i class="fas fa-align-left mr-2 text-primary"></i>
                            Video Description
                        </label>
                        <textarea rows="3" 
                            name="introductionVideoDescription" 
                            formControlName="introductionVideoDescription" 
                            placeholder="Enter video description" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition resize-none bg-white"></textarea>
                    </div>
                </div>
                <div id="youtubeLinkPreview" class="mt-3"></div>
            </div>
        </div>

        <!-- Divider -->
        <div class="border-t border-gray-200"></div>

        <!-- Professional Information Section -->
        <div class="space-y-6">
            <div class="pb-2 border-b border-gray-100">
                <h4 class="text-2xl font-bold text-gray-900 mb-2 flex items-center gap-3">
                    <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-briefcase text-primary text-lg"></i>
                    </div>
                    <span>Professional Information</span>
                </h4>
                <p class="text-sm text-gray-600 mt-2 ml-13">Share your professional background and expertise</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Preferred Subject -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-800">
                        <i class="fas fa-book mr-2 text-primary"></i>
                        Preferred Subject
                        <span class="text-red-500 ml-1">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fas fa-book text-gray-400"></i>
                        </div>
                        <input type="text" 
                            name="preferredSubject" 
                            formControlName="preferredSubject"
                            placeholder="e.g., Mathematics, Science, English"
                            class="w-full pl-11 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition bg-gray-50/50">
                    </div>
                    @if(professionalForm.get('preferredSubject')?.invalid && professionalForm.get('preferredSubject')?.touched) {
                    <p class="mt-1 text-xs text-red-600 flex items-center gap-1">
                        <i class="fas fa-exclamation-circle"></i>
                        Preferred subject is required
                    </p>
                    }
                </div>

                <!-- Years of Experience -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-800">
                        <i class="fas fa-calendar-alt mr-2 text-primary"></i>
                        Years of Experience
                        <span class="text-red-500 ml-1">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fas fa-calendar-alt text-gray-400"></i>
                        </div>
                        <input type="text" 
                            name="yearsOfExperience" 
                            formControlName="yearsOfExperience"
                            placeholder="0"
                            min="0"
                            class="w-full pl-11 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition bg-gray-50/50">
                    </div>
                    @if(professionalForm.get('yearsOfExperience')?.invalid && professionalForm.get('yearsOfExperience')?.touched) {
                    <p class="mt-1 text-xs text-red-600 flex items-center gap-1">
                        <i class="fas fa-exclamation-circle"></i>
                        Years of experience is required
                    </p>
                    }
                </div>

                <!-- Bio / Tagline -->
                <div class="md:col-span-2 space-y-2">
                    <label class="block text-sm font-semibold text-gray-800">
                        <i class="fas fa-quote-left mr-2 text-primary"></i>
                        Bio / Tagline
                        <span class="text-red-500 ml-1">*</span>
                    </label>
                    <div class="relative">
                        <textarea rows="3"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition resize-none bg-gray-50/50"
                            placeholder="Write a catchy tagline or short bio that describes your teaching style..."
                            name="bio" 
                            formControlName="bio"></textarea>
                    </div>
                    @if(professionalForm.get('bio')?.invalid && professionalForm.get('bio')?.touched) {
                    <p class="mt-1 text-xs text-red-600 flex items-center gap-1">
                        <i class="fas fa-exclamation-circle"></i>
                        Bio/Tagline is required
                    </p>
                    }
                </div>
            </div>
        </div>        
        <!-- Save Button -->
        <div class="flex justify-end pt-6 border-t border-gray-200">
            <button type="button"
                [ngClass]="{'bg-gray-400 cursor-not-allowed': !hasChanges, 'bg-primary hover:bg-primary/90 active:scale-95': hasChanges}"
                class="px-8 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg text-white disabled:opacity-50 min-w-[160px]"
                [disabled]="!hasChanges || isSaving()" 
                (click)="onSaveChanges()">
                <i class="fas"
                    [ngClass]="{'fa-spinner fa-spin': isSaving(), 'fa-save': !isSaving()}"></i>
                @if(isSaving()) {
                <span>Saving Changes...</span>
                } @else {
                <span>Save Changes</span>
                }
            </button>
        </div>
    </div>
</form>