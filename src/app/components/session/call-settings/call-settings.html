<!-- Call Settings Modal -->
<p-dialog 
    [visible]="showSettings()" 
    [modal]="true" 
    [closable]="false"
    [draggable]="false"
    [resizable]="false"
    styleClass="w-[95vw] sm:w-full max-w-2xl"
    [breakpoints]="{'960px': '95vw', '640px': '100vw'}"
    [style]="{width: '95vw', maxWidth: '42rem'}"
    (onHide)="closeSettings()">
    <ng-template pTemplate="header">
        <div class="flex items-center justify-between w-full pr-2">
            <div class="flex items-center gap-3 sm:gap-4 justify-between w-full">
                <div class="w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-primary to-primary/80 rounded-xl flex items-center justify-center text-white shadow-lg flex-shrink-0">
                    <i class="fas fa-cog text-lg sm:text-xl"></i>
                </div>
                <div class="min-w-0 flex-1">
                    <h2 class="text-lg sm:text-xl md:text-2xl font-bold text-gray-900 mb-1">
                        Call Settings
                    </h2>
                    <p class="text-sm text-gray-500">Configure your audio, video, and connection settings</p>
                </div>
                <button
                    (click)="closeSettings()"
                    class="w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded-full hover:bg-gray-100"
                    title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </ng-template>
    
    <div class="space-y-6 py-2">
        <!-- Audio Settings -->
        <div class="border-b border-gray-200 pb-4">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-microphone text-blue-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Audio Settings</h3>
            </div>
            
            <div class="space-y-4 pl-14">
                <!-- Microphone Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-microphone-alt mr-2 text-gray-500"></i>
                        Microphone
                    </label>
                    <select 
                        [(ngModel)]="selectedMicrophone"
                        (change)="onMicrophoneChange($any($event.target).value)"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white text-gray-900">
                        @for(mic of availableMicrophones(); track mic.deviceId) {
                            <option [value]="mic.deviceId">{{ mic.label || 'Microphone ' + ($index + 1) }}</option>
                        }
                    </select>
                </div>
                
                <!-- Microphone Volume -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-700">
                            <i class="fas fa-volume-up mr-2 text-gray-500"></i>
                            Input Volume
                        </label>
                        <span class="text-sm text-gray-500">{{ microphoneVolume }}%</span>
                    </div>
                    <input 
                        type="range" 
                        [(ngModel)]="microphoneVolume"
                        min="0" 
                        max="100" 
                        step="1"
                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                </div>
            </div>
        </div>
        
        <!-- Video Settings -->
        <div class="border-b border-gray-200 pb-4">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-video text-green-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Video Settings</h3>
            </div>
            
            <div class="space-y-4 pl-14">
                <!-- Camera Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-camera mr-2 text-gray-500"></i>
                        Camera
                    </label>
                    <select 
                        [(ngModel)]="selectedCamera"
                        (change)="onCameraChange($any($event.target).value)"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white text-gray-900">
                        @for(camera of availableCameras(); track camera.deviceId) {
                            <option [value]="camera.deviceId">{{ camera.label || 'Camera ' + ($index + 1) }}</option>
                        }
                    </select>
                </div>
                
                <!-- Video Quality -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-hd-video mr-2 text-gray-500"></i>
                        Video Quality
                    </label>
                    <select 
                        [(ngModel)]="videoQuality"
                        (change)="onVideoQualityChange($any($event.target).value)"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white text-gray-900">
                        <option value="auto">Auto (Recommended)</option>
                        <option value="high">High (1080p)</option>
                        <option value="medium">Medium (720p)</option>
                        <option value="low">Low (480p)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- General Settings -->
        <div class="border-b border-gray-200 pb-4">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-sliders-h text-purple-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">General Settings</h3>
            </div>
            
            <div class="space-y-3 pl-14">
                <!-- Enable Notifications -->
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-bell text-gray-500"></i>
                        <label class="text-sm font-medium text-gray-700 cursor-pointer">Enable Notifications</label>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input 
                            type="checkbox" 
                            [(ngModel)]="enableNotifications"
                            class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
                
                <!-- Enable Sound Effects -->
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-volume-up text-gray-500"></i>
                        <label class="text-sm font-medium text-gray-700 cursor-pointer">Enable Sound Effects</label>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input 
                            type="checkbox" 
                            [(ngModel)]="enableSoundEffects"
                            class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
                
                <!-- Auto Join With Video -->
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-video text-gray-500"></i>
                        <label class="text-sm font-medium text-gray-700 cursor-pointer">Auto Join With Video</label>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input 
                            type="checkbox" 
                            [(ngModel)]="autoJoinWithVideo"
                            class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
                
                <!-- Auto Join With Audio -->
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-microphone text-gray-500"></i>
                        <label class="text-sm font-medium text-gray-700 cursor-pointer">Auto Join With Audio</label>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input 
                            type="checkbox" 
                            [(ngModel)]="autoJoinWithAudio"
                            class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Connection Info -->
        <div>
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-wifi text-orange-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Connection</h3>
            </div>
            
            <div class="space-y-3 pl-14">
                <!-- Connection Quality -->
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-signal text-gray-500"></i>
                        <span class="text-sm font-medium text-gray-700">Connection Quality</span>
                    </div>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                        {{ connectionQuality() | titlecase }}
                    </span>
                </div>
                
                <!-- Bandwidth -->
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-tachometer-alt text-gray-500"></i>
                        <span class="text-sm font-medium text-gray-700">Bandwidth</span>
                    </div>
                    <span class="text-sm text-gray-600">{{ bandwidth() }}</span>
                </div>
            </div>
        </div>
    </div>
    
    <ng-template pTemplate="footer">
        <div class="flex items-center justify-end gap-3">
            <button
                type="button"
                (click)="closeSettings()"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-200">
                <i class="fas fa-times mr-2"></i>
                Close
            </button>
            <button
                type="button"
                (click)="closeSettings()"
                class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-orange-600 rounded-lg transition-colors duration-200">
                <i class="fas fa-check mr-2"></i>
                Save Settings
            </button>
        </div>
    </ng-template>
</p-dialog>